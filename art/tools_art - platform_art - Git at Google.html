<!DOCTYPE html>
<!-- saved from url=(0064)https://android.googlesource.com/platform/art/+/master/tools/art -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>tools/art - platform/art - Git at Google</title><link rel="stylesheet" type="text/css" href="./tools_art - platform_art - Git at Google_files/base.css"><link rel="stylesheet" type="text/css" href="./tools_art - platform_art - Git at Google_files/prettify.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="https://android.googlesource.com/"><img src="./tools_art - platform_art - Git at Google_files/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?faa=1&amp;service=gerritcodereview&amp;continue=https://android.googlesource.com/login/platform/art/%2B/refs/heads/main/tools/art">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="https://android.googlesource.com/?format=HTML">android</a> / <a class="Breadcrumbs-crumb" href="https://android.googlesource.com/platform/">platform</a> / <a class="Breadcrumbs-crumb" href="https://android.googlesource.com/platform/art/">art</a> / <a class="Breadcrumbs-crumb" href="https://android.googlesource.com/platform/art/+/refs/heads/main">refs/heads/main</a> / <a class="Breadcrumbs-crumb" href="https://android.googlesource.com/platform/art/+/refs/heads/main/">.</a> / <a class="Breadcrumbs-crumb" href="https://android.googlesource.com/platform/art/+/refs/heads/main/tools">tools</a> / <span class="Breadcrumbs-crumb">art</span></div><div class="u-sha1 u-monospace BlobSha1">blob: 47724de9f96feef477fd8c0d74c5f229fe3bef6c [<a href="https://android.googlesource.com/platform/art/+/refs/heads/main/tools/art">file</a>] [<a href="https://android.googlesource.com/platform/art/+log/refs/heads/main/tools/art">log</a>] [<a href="https://android.googlesource.com/platform/art/+blame/refs/heads/main/tools/art">blame</a>]</div><table class="FileContents"><tbody><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="1"></td><td class="FileContents-lineContents" id="1"><span class="com">#! /bin/sh</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="2"></td><td class="FileContents-lineContents" id="2"><span class="com"># Copyright (C) 2011 The Android Open Source Project</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="3"></td><td class="FileContents-lineContents" id="3"><span class="com">#</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="4"></td><td class="FileContents-lineContents" id="4"><span class="com"># Licensed under the Apache License, Version 2.0 (the "License");</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="5"></td><td class="FileContents-lineContents" id="5"><span class="com"># you may not use this file except in compliance with the License.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="6"></td><td class="FileContents-lineContents" id="6"><span class="com"># You may obtain a copy of the License at</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="7"></td><td class="FileContents-lineContents" id="7"><span class="com">#</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="8"></td><td class="FileContents-lineContents" id="8"><span class="com">#     http://www.apache.org/licenses/LICENSE-2.0</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="9"></td><td class="FileContents-lineContents" id="9"><span class="com">#</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="10"></td><td class="FileContents-lineContents" id="10"><span class="com"># Unless required by applicable law or agreed to in writing, software</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="11"></td><td class="FileContents-lineContents" id="11"><span class="com"># distributed under the License is distributed on an "AS IS" BASIS,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="12"></td><td class="FileContents-lineContents" id="12"><span class="com"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="13"></td><td class="FileContents-lineContents" id="13"><span class="com"># See the License for the specific language governing permissions and</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="14"></td><td class="FileContents-lineContents" id="14"><span class="com"># limitations under the License.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="15"></td><td class="FileContents-lineContents" id="15"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="16"></td><td class="FileContents-lineContents" id="16"><span class="com"># This script is used on host and device. It uses a common subset</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="17"></td><td class="FileContents-lineContents" id="17"><span class="com"># shell dialect that should work on the host (e.g. bash), and</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="18"></td><td class="FileContents-lineContents" id="18"><span class="com"># Android (e.g. mksh). Try to switch to bash if the shebang above</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="19"></td><td class="FileContents-lineContents" id="19"><span class="com"># has launched a pessimal shell on host.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="20"></td><td class="FileContents-lineContents" id="20"><span class="kwd">if</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><span class="pun">-</span><span class="pln">z </span><span class="str">"$KSH_VERSION"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">a </span><span class="pun">-</span><span class="pln">z </span><span class="str">"$BASH_VERSION"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">a </span><span class="pun">-</span><span class="pln">n </span><span class="str">"$(which bash)"</span><span class="pln"> </span><span class="pun">];</span><span class="pln"> </span><span class="kwd">then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="21"></td><td class="FileContents-lineContents" id="21"><span class="pln">  </span><span class="kwd">exec</span><span class="pln"> bash </span><span class="pun">-</span><span class="pln">c </span><span class="str">". $0"</span><span class="pln"> </span><span class="pun">--</span><span class="pln"> </span><span class="str">"$@"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="22"></td><td class="FileContents-lineContents" id="22"><span class="kwd">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="23"></td><td class="FileContents-lineContents" id="23"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="24"></td><td class="FileContents-lineContents" id="24"><span class="com">######################################</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="25"></td><td class="FileContents-lineContents" id="25"><span class="com"># Functions</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="26"></td><td class="FileContents-lineContents" id="26"><span class="com">######################################</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="27"></td><td class="FileContents-lineContents" id="27"><span class="kwd">function</span><span class="pln"> find_libdir</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="28"></td><td class="FileContents-lineContents" id="28"><span class="pln">  </span><span class="com"># Get the actual file, $1 is the ART_BINARY_PATH and may be a symbolic link.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="29"></td><td class="FileContents-lineContents" id="29"><span class="pln">  </span><span class="com"># Use realpath instead of readlink because Android does not have a readlink.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="30"></td><td class="FileContents-lineContents" id="30"><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">[[</span><span class="pln"> </span><span class="str">"$(realpath "</span><span class="pln">$1</span><span class="str">")"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">*</span><span class="pln">dalvikvm64 </span><span class="pun">]];</span><span class="pln"> </span><span class="kwd">then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="31"></td><td class="FileContents-lineContents" id="31"><span class="pln">    echo </span><span class="str">"lib64"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="32"></td><td class="FileContents-lineContents" id="32"><span class="pln">  </span><span class="kwd">else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="33"></td><td class="FileContents-lineContents" id="33"><span class="pln">    echo </span><span class="str">"lib"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="34"></td><td class="FileContents-lineContents" id="34"><span class="pln">  </span><span class="kwd">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="35"></td><td class="FileContents-lineContents" id="35"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="36"></td><td class="FileContents-lineContents" id="36"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="37"></td><td class="FileContents-lineContents" id="37"><span class="kwd">function</span><span class="pln"> usage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="38"></td><td class="FileContents-lineContents" id="38"><span class="pln">  cat </span><span class="lit">1</span><span class="pun">&gt;&amp;</span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln">EOF</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="39"></td><td class="FileContents-lineContents" id="39"><span class="typ">Usage</span><span class="pun">:</span><span class="pln"> art </span><span class="pun">[</span><span class="pln">OPTIONS</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--]</span><span class="pln"> </span><span class="pun">[</span><span class="pln">ART_OPTIONS</span><span class="pun">]</span><span class="pln"> CLASS</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="40"></td><td class="FileContents-lineContents" id="40"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="41"></td><td class="FileContents-lineContents" id="41"><span class="typ">Supported</span><span class="pln"> OPTIONS include</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="42"></td><td class="FileContents-lineContents" id="42"><span class="pln">  </span><span class="pun">--</span><span class="lit">32</span><span class="pln">                     </span><span class="typ">Use</span><span class="pln"> the </span><span class="lit">32</span><span class="pun">-</span><span class="pln">bit </span><span class="typ">Android</span><span class="pln"> </span><span class="typ">Runtime</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="43"></td><td class="FileContents-lineContents" id="43"><span class="pln">  </span><span class="pun">--</span><span class="lit">64</span><span class="pln">                     </span><span class="typ">Use</span><span class="pln"> the </span><span class="lit">64</span><span class="pun">-</span><span class="pln">bit </span><span class="typ">Android</span><span class="pln"> </span><span class="typ">Runtime</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="44"></td><td class="FileContents-lineContents" id="44"><span class="pln">  </span><span class="pun">-</span><span class="pln">d                       </span><span class="typ">Use</span><span class="pln"> the debug ART library </span><span class="pun">(</span><span class="pln">libartd</span><span class="pun">.</span><span class="pln">so</span><span class="pun">).</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="45"></td><td class="FileContents-lineContents" id="45"><span class="pln">  </span><span class="pun">--</span><span class="pln">debug                  </span><span class="typ">Equivalent</span><span class="pln"> to </span><span class="pun">-</span><span class="pln">d</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="46"></td><td class="FileContents-lineContents" id="46"><span class="pln">  </span><span class="pun">--</span><span class="pln">gdb                    </span><span class="typ">Launch</span><span class="pln"> the </span><span class="typ">Android</span><span class="pln"> </span><span class="typ">Runtime</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> gdb</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="47"></td><td class="FileContents-lineContents" id="47"><span class="pln">  </span><span class="pun">--</span><span class="pln">gdbserver </span><span class="str">&lt;comms&gt;</span><span class="pln">      </span><span class="typ">Launch</span><span class="pln"> the </span><span class="typ">Android</span><span class="pln"> </span><span class="typ">Runtime</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> gdbserver </span><span class="kwd">using</span><span class="pln"> the</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="48"></td><td class="FileContents-lineContents" id="48"><span class="pln">                           supplied communication channel</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="49"></td><td class="FileContents-lineContents" id="49"><span class="pln">  </span><span class="pun">--</span><span class="pln">help                   </span><span class="typ">Display</span><span class="pln"> usage message</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="50"></td><td class="FileContents-lineContents" id="50"><span class="pln">  </span><span class="pun">--</span><span class="pln">invoke</span><span class="pun">-</span><span class="kwd">with</span><span class="pln"> </span><span class="str">&lt;program&gt;</span><span class="pln">  </span><span class="typ">Launch</span><span class="pln"> the </span><span class="typ">Android</span><span class="pln"> </span><span class="typ">Runtime</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="str">&lt;program&gt;</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="51"></td><td class="FileContents-lineContents" id="51"><span class="pln">  </span><span class="pun">--</span><span class="pln">perf                   </span><span class="typ">Launch</span><span class="pln"> the </span><span class="typ">Android</span><span class="pln"> </span><span class="typ">Runtime</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> perf recording</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="52"></td><td class="FileContents-lineContents" id="52"><span class="pln">  </span><span class="pun">--</span><span class="pln">perf</span><span class="pun">-</span><span class="pln">report            </span><span class="typ">Launch</span><span class="pln"> the </span><span class="typ">Android</span><span class="pln"> </span><span class="typ">Runtime</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> perf recording </span><span class="kwd">with</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="53"></td><td class="FileContents-lineContents" id="53"><span class="pln">                           report upon completion</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="54"></td><td class="FileContents-lineContents" id="54"><span class="pln">  </span><span class="pun">--</span><span class="pln">profile                </span><span class="typ">Run</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> profiling</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">then</span><span class="pln"> run </span><span class="kwd">using</span><span class="pln"> profile data</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="55"></td><td class="FileContents-lineContents" id="55"><span class="pln">  </span><span class="pun">--</span><span class="pln">verbose                </span><span class="typ">Run</span><span class="pln"> script verbosely</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="56"></td><td class="FileContents-lineContents" id="56"><span class="pln">  </span><span class="pun">--</span><span class="kwd">no</span><span class="pun">-</span><span class="pln">clean               </span><span class="typ">Don</span><span class="str">'t cleanup oat directories.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="57"></td><td class="FileContents-lineContents" id="57"><span class="str">  --no-compile             Don'</span><span class="pln">t invoke dex2oat before running</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="58"></td><td class="FileContents-lineContents" id="58"><span class="pln">  </span><span class="pun">--</span><span class="pln">allow</span><span class="pun">-</span><span class="kwd">default</span><span class="pun">-</span><span class="pln">jdwp     </span><span class="typ">Don</span><span class="str">'t automatically put in -XjdwpProvider:none.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="59"></td><td class="FileContents-lineContents" id="59"><span class="str">                           You probably do not want this.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="60"></td><td class="FileContents-lineContents" id="60"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="61"></td><td class="FileContents-lineContents" id="61"><span class="str">The ART_OPTIONS are passed directly to the Android Runtime.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="62"></td><td class="FileContents-lineContents" id="62"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="63"></td><td class="FileContents-lineContents" id="63"><span class="str">Example:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="64"></td><td class="FileContents-lineContents" id="64"><span class="str">  art --32 -cp my_classes.dex MainClass</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="65"></td><td class="FileContents-lineContents" id="65"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="66"></td><td class="FileContents-lineContents" id="66"><span class="str">Common errors:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="67"></td><td class="FileContents-lineContents" id="67"><span class="str">  1) Not having core.art available (see $ANDROID_BUILD_TOP/art/Android.mk).</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="68"></td><td class="FileContents-lineContents" id="68"><span class="str">     eg m -j32 build-art-host</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="69"></td><td class="FileContents-lineContents" id="69"><span class="str">  2) Not having boot.art available (see $ANDROID_BUILD_TOP/build/make/core/dex_preopt_libart_boot.mk)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="70"></td><td class="FileContents-lineContents" id="70"><span class="str">     eg m -j32 out/target/product/generic_x86_64/dex_bootjars/system/framework/x86_64/boot.art</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="71"></td><td class="FileContents-lineContents" id="71"><span class="str">EOF</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="72"></td><td class="FileContents-lineContents" id="72"><span class="str">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="73"></td><td class="FileContents-lineContents" id="73"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="74"></td><td class="FileContents-lineContents" id="74"><span class="str">function clean_android_data() {</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="75"></td><td class="FileContents-lineContents" id="75"><span class="str">  if [ "$DELETE_ANDROID_DATA" = "yes" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="76"></td><td class="FileContents-lineContents" id="76"><span class="str">    rm -rf $ANDROID_DATA</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="77"></td><td class="FileContents-lineContents" id="77"><span class="str">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="78"></td><td class="FileContents-lineContents" id="78"><span class="str">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="79"></td><td class="FileContents-lineContents" id="79"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="80"></td><td class="FileContents-lineContents" id="80"><span class="str"># Given '</span><span class="pln">VAR1</span><span class="pun">=</span><span class="pln">VAL VAR2</span><span class="pun">=</span><span class="pln">VAL2 </span><span class="pun">...</span><span class="pln"> cmd arg1 arg2 </span><span class="pun">...</span><span class="pln"> argN</span><span class="str">' run the '</span><span class="pln">cmd</span><span class="str">' with the args</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="81"></td><td class="FileContents-lineContents" id="81"><span class="str"># with the modified environment {VAR1=VAL,VAL2=,...}.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="82"></td><td class="FileContents-lineContents" id="82"><span class="str">#</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="83"></td><td class="FileContents-lineContents" id="83"><span class="str"># Also prints the command to be run if verbose mode is enabled.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="84"></td><td class="FileContents-lineContents" id="84"><span class="str">function verbose_run() {</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="85"></td><td class="FileContents-lineContents" id="85"><span class="str">  if [ "$VERBOSE" = "yes" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="86"></td><td class="FileContents-lineContents" id="86"><span class="str">    echo "$@"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="87"></td><td class="FileContents-lineContents" id="87"><span class="str">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="88"></td><td class="FileContents-lineContents" id="88"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="89"></td><td class="FileContents-lineContents" id="89"><span class="str">  env "$@"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="90"></td><td class="FileContents-lineContents" id="90"><span class="str">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="91"></td><td class="FileContents-lineContents" id="91"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="92"></td><td class="FileContents-lineContents" id="92"><span class="str"># Parse a colon-separated list into an array (e.g. "foo.dex:bar.dex" -&gt; (foo.dex bar.dex))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="93"></td><td class="FileContents-lineContents" id="93"><span class="str">PARSE_CLASSPATH_RESULT=()  # Return value will be here due to shell limitations.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="94"></td><td class="FileContents-lineContents" id="94"><span class="str">parse_classpath() {</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="95"></td><td class="FileContents-lineContents" id="95"><span class="str">  local cp="$1"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="96"></td><td class="FileContents-lineContents" id="96"><span class="str">  local oldifs=$IFS</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="97"></td><td class="FileContents-lineContents" id="97"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="98"></td><td class="FileContents-lineContents" id="98"><span class="str">  local cp_array</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="99"></td><td class="FileContents-lineContents" id="99"><span class="str">  cp_array=()</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="100"></td><td class="FileContents-lineContents" id="100"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="101"></td><td class="FileContents-lineContents" id="101"><span class="str">  IFS=":"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="102"></td><td class="FileContents-lineContents" id="102"><span class="str">  for part in $cp; do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="103"></td><td class="FileContents-lineContents" id="103"><span class="str">    cp_array+=("$part")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="104"></td><td class="FileContents-lineContents" id="104"><span class="str">  done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="105"></td><td class="FileContents-lineContents" id="105"><span class="str">  IFS=$oldifs</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="106"></td><td class="FileContents-lineContents" id="106"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="107"></td><td class="FileContents-lineContents" id="107"><span class="str">  PARSE_CLASSPATH_RESULT=("${cp_array[@]}")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="108"></td><td class="FileContents-lineContents" id="108"><span class="str">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="109"></td><td class="FileContents-lineContents" id="109"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="110"></td><td class="FileContents-lineContents" id="110"><span class="str"># Sets '</span><span class="pln">PARSE_CLASSPATH_RESULT</span><span class="str">' to an array of class path dex files.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="111"></td><td class="FileContents-lineContents" id="111"><span class="str"># e.g. (-cp foo/classes.dex:bar/classes.dex) -&gt; (foo/classes.dex bar/classes.dex)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="112"></td><td class="FileContents-lineContents" id="112"><span class="str">find_cp_in_args() {</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="113"></td><td class="FileContents-lineContents" id="113"><span class="str">  local found="false"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="114"></td><td class="FileContents-lineContents" id="114"><span class="str">  local index=0</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="115"></td><td class="FileContents-lineContents" id="115"><span class="str">  local what</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="116"></td><td class="FileContents-lineContents" id="116"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="117"></td><td class="FileContents-lineContents" id="117"><span class="str">  while [[ $# -gt 0 ]]; do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="118"></td><td class="FileContents-lineContents" id="118"><span class="str">    case "$1" in</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="119"></td><td class="FileContents-lineContents" id="119"><span class="str">      -cp|-classpath)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="120"></td><td class="FileContents-lineContents" id="120"><span class="str">        parse_classpath "$2"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="121"></td><td class="FileContents-lineContents" id="121"><span class="str">        # Sets '</span><span class="pln">PARSE_CLASSPATH_RESULT</span><span class="str">' to an array of class path dex files.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="122"></td><td class="FileContents-lineContents" id="122"><span class="str">        # Subsequent parses will overwrite the preceding.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="123"></td><td class="FileContents-lineContents" id="123"><span class="str">        shift</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="124"></td><td class="FileContents-lineContents" id="124"><span class="str">        ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="125"></td><td class="FileContents-lineContents" id="125"><span class="str">    esac</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="126"></td><td class="FileContents-lineContents" id="126"><span class="str">    shift</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="127"></td><td class="FileContents-lineContents" id="127"><span class="str">  done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="128"></td><td class="FileContents-lineContents" id="128"><span class="str">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="129"></td><td class="FileContents-lineContents" id="129"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="130"></td><td class="FileContents-lineContents" id="130"><span class="str"># Delete the '</span><span class="pln">oat</span><span class="str">' directories relative to the classpath'</span><span class="pln">s dex files</span><span class="pun">.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="131"></td><td class="FileContents-lineContents" id="131"><span class="com"># e.g. (foo/classes.dex bar/classes.dex) would delete (foo/oat bar/oat) directories.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="132"></td><td class="FileContents-lineContents" id="132"><span class="pln">cleanup_oat_directory</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="133"></td><td class="FileContents-lineContents" id="133"><span class="pln">  </span><span class="kwd">local</span><span class="pln"> classpath</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="134"></td><td class="FileContents-lineContents" id="134"><span class="pln">  classpath</span><span class="pun">=(</span><span class="str">"$@"</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="135"></td><td class="FileContents-lineContents" id="135"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="136"></td><td class="FileContents-lineContents" id="136"><span class="pln">  </span><span class="kwd">local</span><span class="pln"> dirpath</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="137"></td><td class="FileContents-lineContents" id="137"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="138"></td><td class="FileContents-lineContents" id="138"><span class="pln">  </span><span class="kwd">for</span><span class="pln"> path </span><span class="kwd">in</span><span class="pln"> </span><span class="str">"${classpath[@]}"</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="139"></td><td class="FileContents-lineContents" id="139"><span class="pln">    dirpath</span><span class="pun">=</span><span class="str">"$(dirname "</span><span class="pln">$path</span><span class="str">")"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="140"></td><td class="FileContents-lineContents" id="140"><span class="pln">    </span><span class="pun">[[</span><span class="pln"> </span><span class="pun">-</span><span class="pln">d </span><span class="str">"$dirpath"</span><span class="pln"> </span><span class="pun">]]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> verbose_run rm </span><span class="pun">-</span><span class="pln">rf </span><span class="str">"$dirpath/oat"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="141"></td><td class="FileContents-lineContents" id="141"><span class="pln">  </span><span class="kwd">done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="142"></td><td class="FileContents-lineContents" id="142"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="143"></td><td class="FileContents-lineContents" id="143"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="144"></td><td class="FileContents-lineContents" id="144"><span class="com"># Parse -cp &lt;CP&gt;, -classpath &lt;CP&gt;, and $CLASSPATH to find the dex files.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="145"></td><td class="FileContents-lineContents" id="145"><span class="com"># Each dex file's directory will have an 'oat' file directory, delete it.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="146"></td><td class="FileContents-lineContents" id="146"><span class="com"># Input: Command line arguments to the art script.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="147"></td><td class="FileContents-lineContents" id="147"><span class="com"># e.g. -cp foo/classes.dex:bar/classes.dex would delete (foo/oat bar/oat) directories.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="148"></td><td class="FileContents-lineContents" id="148"><span class="pln">cleanup_oat_directory_for_classpath</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="149"></td><td class="FileContents-lineContents" id="149"><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><span class="str">"$CLEAN_OAT_FILES"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"yes"</span><span class="pln"> </span><span class="pun">];</span><span class="pln"> </span><span class="kwd">then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="150"></td><td class="FileContents-lineContents" id="150"><span class="pln">    </span><span class="com"># First try: Use $CLASSPATH environment variable.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="151"></td><td class="FileContents-lineContents" id="151"><span class="pln">    parse_classpath </span><span class="str">"$CLASSPATH"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="152"></td><td class="FileContents-lineContents" id="152"><span class="pln">    </span><span class="com"># Second try: Look for latest -cp or -classpath arg which will take precedence.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="153"></td><td class="FileContents-lineContents" id="153"><span class="pln">    find_cp_in_args </span><span class="str">"$@"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="154"></td><td class="FileContents-lineContents" id="154"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="155"></td><td class="FileContents-lineContents" id="155"><span class="pln">    cleanup_oat_directory </span><span class="str">"${PARSE_CLASSPATH_RESULT[@]}"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="156"></td><td class="FileContents-lineContents" id="156"><span class="pln">  </span><span class="kwd">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="157"></td><td class="FileContents-lineContents" id="157"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="158"></td><td class="FileContents-lineContents" id="158"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="159"></td><td class="FileContents-lineContents" id="159"><span class="com"># Attempt to find $ANDROID_ROOT/framework/&lt;isa&gt;/core.art' without knowing what &lt;isa&gt; is.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="160"></td><td class="FileContents-lineContents" id="160"><span class="kwd">function</span><span class="pln"> check_if_boot_image_file_exists</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="161"></td><td class="FileContents-lineContents" id="161"><span class="pln">  </span><span class="kwd">local</span><span class="pln"> image_location_dir</span><span class="pun">=</span><span class="str">"$1"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="162"></td><td class="FileContents-lineContents" id="162"><span class="pln">  </span><span class="kwd">local</span><span class="pln"> image_location_name</span><span class="pun">=</span><span class="str">"$2"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="163"></td><td class="FileContents-lineContents" id="163"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="164"></td><td class="FileContents-lineContents" id="164"><span class="pln">  </span><span class="com"># Expand image_files to a list of existing image files on the disk.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="165"></td><td class="FileContents-lineContents" id="165"><span class="pln">  </span><span class="com"># If no such files exist, it expands to single element 'dir/*/file' with a literal '*'.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="166"></td><td class="FileContents-lineContents" id="166"><span class="pln">  </span><span class="kwd">local</span><span class="pln"> image_files</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="167"></td><td class="FileContents-lineContents" id="167"><span class="pln">  image_files</span><span class="pun">=(</span><span class="str">"$image_location_dir"</span><span class="com">/*/"$image_location_name") # avoid treating "*" as literal.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="168"></td><td class="FileContents-lineContents" id="168"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="169"></td><td class="FileContents-lineContents" id="169"><span class="com">  # Array always has at least 1 element. Test explicitly whether the file exists.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="170"></td><td class="FileContents-lineContents" id="170"><span class="com">  [[ -e "${image_files[0]}" ]]</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="171"></td><td class="FileContents-lineContents" id="171"><span class="com">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="172"></td><td class="FileContents-lineContents" id="172"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="173"></td><td class="FileContents-lineContents" id="173"><span class="com"># Automatically find the boot image location. It uses core.art by default.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="174"></td><td class="FileContents-lineContents" id="174"><span class="com"># On a real device, it might only have a boot.art, so use that instead when core.art does not exist.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="175"></td><td class="FileContents-lineContents" id="175"><span class="com">function detect_boot_image_location() {</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="176"></td><td class="FileContents-lineContents" id="176"><span class="com">  local image_location_dir="$ANDROID_ROOT/framework"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="177"></td><td class="FileContents-lineContents" id="177"><span class="com">  local image_location_name="core.art"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="178"></td><td class="FileContents-lineContents" id="178"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="179"></td><td class="FileContents-lineContents" id="179"><span class="com">  # If there are no existing core.art, try to find boot.art.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="180"></td><td class="FileContents-lineContents" id="180"><span class="com">  # If there is no boot.art then leave it as-is, assumes -Ximage is explicitly used.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="181"></td><td class="FileContents-lineContents" id="181"><span class="com">  # Otherwise let dalvikvm give the error message about an invalid image file.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="182"></td><td class="FileContents-lineContents" id="182"><span class="com">  if ! check_if_boot_image_file_exists "$image_location_dir" "core.art" &amp;&amp; \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="183"></td><td class="FileContents-lineContents" id="183"><span class="com">       check_if_boot_image_file_exists "$image_location_dir" "boot.art"; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="184"></td><td class="FileContents-lineContents" id="184"><span class="com">    image_location_name="boot.art"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="185"></td><td class="FileContents-lineContents" id="185"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="186"></td><td class="FileContents-lineContents" id="186"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="187"></td><td class="FileContents-lineContents" id="187"><span class="com">  local image_location="$image_location_dir/$image_location_name"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="188"></td><td class="FileContents-lineContents" id="188"><span class="com">  echo "$image_location"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="189"></td><td class="FileContents-lineContents" id="189"><span class="com">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="190"></td><td class="FileContents-lineContents" id="190"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="191"></td><td class="FileContents-lineContents" id="191"><span class="com">function run_dex2oat() {</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="192"></td><td class="FileContents-lineContents" id="192"><span class="com">  local class_loader_context=</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="193"></td><td class="FileContents-lineContents" id="193"><span class="com">  for dex_file in "${DEX2OAT_CLASSPATH[@]}"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="194"></td><td class="FileContents-lineContents" id="194"><span class="com">  do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="195"></td><td class="FileContents-lineContents" id="195"><span class="com">    while [ -h "$dex_file" ]; do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="196"></td><td class="FileContents-lineContents" id="196"><span class="com">      # On Mac OS, readlink -f doesn't work.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="197"></td><td class="FileContents-lineContents" id="197"><span class="com">      dex_file="$(readlink "$dex_file")"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="198"></td><td class="FileContents-lineContents" id="198"><span class="com">    done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="199"></td><td class="FileContents-lineContents" id="199"><span class="com">    # Create oat file directory.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="200"></td><td class="FileContents-lineContents" id="200"><span class="com">    verbose_run mkdir -p $(dirname "$dex_file")/oat/$ISA</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="201"></td><td class="FileContents-lineContents" id="201"><span class="com">    local oat_file=$(basename "$dex_file")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="202"></td><td class="FileContents-lineContents" id="202"><span class="com">    local oat_file=$(dirname "$dex_file")/oat/$ISA/${oat_file%.*}.odex</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="203"></td><td class="FileContents-lineContents" id="203"><span class="com">    if [ "$GENERATE_APP_IMAGE" = "yes" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="204"></td><td class="FileContents-lineContents" id="204"><span class="com">      local art_file=$(basename "$dex_file")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="205"></td><td class="FileContents-lineContents" id="205"><span class="com">      local art_file=$(dirname "$dex_file")/oat/$ISA/${art_file%.*}.art</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="206"></td><td class="FileContents-lineContents" id="206"><span class="com">      DEX2OAT_FLAGS+=("--app-image-file=$art_file")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="207"></td><td class="FileContents-lineContents" id="207"><span class="com">    fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="208"></td><td class="FileContents-lineContents" id="208"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="209"></td><td class="FileContents-lineContents" id="209"><span class="com">    # When running dex2oat use the exact same context as when running dalvikvm.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="210"></td><td class="FileContents-lineContents" id="210"><span class="com">    # (see run_art function)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="211"></td><td class="FileContents-lineContents" id="211"><span class="com">    verbose_run ANDROID_DATA=$ANDROID_DATA                    \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="212"></td><td class="FileContents-lineContents" id="212"><span class="com">          ANDROID_ROOT=$ANDROID_ROOT                          \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="213"></td><td class="FileContents-lineContents" id="213"><span class="com">          ANDROID_I18N_ROOT=$ANDROID_I18N_ROOT                \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="214"></td><td class="FileContents-lineContents" id="214"><span class="com">          ANDROID_ART_ROOT=$ANDROID_ART_ROOT                  \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="215"></td><td class="FileContents-lineContents" id="215"><span class="com">          ANDROID_TZDATA_ROOT=$ANDROID_TZDATA_ROOT            \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="216"></td><td class="FileContents-lineContents" id="216"><span class="com">          LD_LIBRARY_PATH=$LD_LIBRARY_PATH                    \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="217"></td><td class="FileContents-lineContents" id="217"><span class="com">          PATH=$ANDROID_ROOT/bin:$PATH                        \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="218"></td><td class="FileContents-lineContents" id="218"><span class="com">          LD_USE_LOAD_BIAS=1                                  \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="219"></td><td class="FileContents-lineContents" id="219"><span class="com">          ANDROID_LOG_TAGS=$ANDROID_LOG_TAGS                  \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="220"></td><td class="FileContents-lineContents" id="220"><span class="com">          $DEX2OAT_BINARY_PATH                                \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="221"></td><td class="FileContents-lineContents" id="221"><span class="com">          --runtime-arg -Xnorelocate                          \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="222"></td><td class="FileContents-lineContents" id="222"><span class="com">          --boot-image=$DEX2OAT_BOOT_IMAGE                    \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="223"></td><td class="FileContents-lineContents" id="223"><span class="com">          --instruction-set=$ISA                              \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="224"></td><td class="FileContents-lineContents" id="224"><span class="com">          --class-loader-context="PCL[$class_loader_context]" \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="225"></td><td class="FileContents-lineContents" id="225"><span class="com">          "${DEX2OAT_FLAGS[@]}"                               \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="226"></td><td class="FileContents-lineContents" id="226"><span class="com">          --dex-file=$dex_file                                \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="227"></td><td class="FileContents-lineContents" id="227"><span class="com">          --oat-file=$oat_file</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="228"></td><td class="FileContents-lineContents" id="228"><span class="com">    if [[ -n $class_loader_context ]]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="229"></td><td class="FileContents-lineContents" id="229"><span class="com">      class_loader_context+=":"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="230"></td><td class="FileContents-lineContents" id="230"><span class="com">    fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="231"></td><td class="FileContents-lineContents" id="231"><span class="com">    class_loader_context+="$dex_file"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="232"></td><td class="FileContents-lineContents" id="232"><span class="com">  done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="233"></td><td class="FileContents-lineContents" id="233"><span class="com">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="234"></td><td class="FileContents-lineContents" id="234"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="235"></td><td class="FileContents-lineContents" id="235"><span class="com"># Extract the dex2oat flags from the list of arguments.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="236"></td><td class="FileContents-lineContents" id="236"><span class="com"># -Xcompiler-options arguments are stored in DEX2OAT_FLAGS array</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="237"></td><td class="FileContents-lineContents" id="237"><span class="com"># -cp argument is split by ':' and stored in DEX2OAT_CLASSPATH</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="238"></td><td class="FileContents-lineContents" id="238"><span class="com"># -Ximage argument is stored in DEX2OAT_BOOT_IMAGE</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="239"></td><td class="FileContents-lineContents" id="239"><span class="com"># -Xbootclasspath argument is stored in DEX2OAT_BCP</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="240"></td><td class="FileContents-lineContents" id="240"><span class="com"># -Xbootclasspath-locations argument is stored in DEX2OAT_BCP_LOCS</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="241"></td><td class="FileContents-lineContents" id="241"><span class="com">function extract_dex2oat_flags() {</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="242"></td><td class="FileContents-lineContents" id="242"><span class="com">  while [ $# -gt 0 ]; do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="243"></td><td class="FileContents-lineContents" id="243"><span class="com">    case $1 in</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="244"></td><td class="FileContents-lineContents" id="244"><span class="com">      -Xcompiler-option)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="245"></td><td class="FileContents-lineContents" id="245"><span class="com">        DEX2OAT_FLAGS+=("$2")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="246"></td><td class="FileContents-lineContents" id="246"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="247"></td><td class="FileContents-lineContents" id="247"><span class="com">        # Enable app images for profile filters</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="248"></td><td class="FileContents-lineContents" id="248"><span class="com">        case $2 in</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="249"></td><td class="FileContents-lineContents" id="249"><span class="com">          --compiler-filter=speed-profile)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="250"></td><td class="FileContents-lineContents" id="250"><span class="com">            GENERATE_APP_IMAGE="yes"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="251"></td><td class="FileContents-lineContents" id="251"><span class="com">            ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="252"></td><td class="FileContents-lineContents" id="252"><span class="com">          --compiler-filter=everything-profile)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="253"></td><td class="FileContents-lineContents" id="253"><span class="com">            GENERATE_APP_IMAGE="yes"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="254"></td><td class="FileContents-lineContents" id="254"><span class="com">            ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="255"></td><td class="FileContents-lineContents" id="255"><span class="com">        esac</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="256"></td><td class="FileContents-lineContents" id="256"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="257"></td><td class="FileContents-lineContents" id="257"><span class="com">        shift</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="258"></td><td class="FileContents-lineContents" id="258"><span class="com">        ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="259"></td><td class="FileContents-lineContents" id="259"><span class="com">      -Ximage:*)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="260"></td><td class="FileContents-lineContents" id="260"><span class="com">        DEX2OAT_BOOT_IMAGE=$1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="261"></td><td class="FileContents-lineContents" id="261"><span class="com">        # Remove '-Ximage:' from the argument.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="262"></td><td class="FileContents-lineContents" id="262"><span class="com">        DEX2OAT_BOOT_IMAGE=${DEX2OAT_BOOT_IMAGE##-Ximage:}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="263"></td><td class="FileContents-lineContents" id="263"><span class="com">        ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="264"></td><td class="FileContents-lineContents" id="264"><span class="com">      -Xbootclasspath:*)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="265"></td><td class="FileContents-lineContents" id="265"><span class="com">        DEX2OAT_BCP=$1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="266"></td><td class="FileContents-lineContents" id="266"><span class="com">        # Remove '-Xbootclasspath:' from the argument.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="267"></td><td class="FileContents-lineContents" id="267"><span class="com">        DEX2OAT_BCP=${DEX2OAT_BCP##-Xbootclasspath:}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="268"></td><td class="FileContents-lineContents" id="268"><span class="com">        ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="269"></td><td class="FileContents-lineContents" id="269"><span class="com">      -Xbootclasspath-locations:*)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="270"></td><td class="FileContents-lineContents" id="270"><span class="com">        DEX2OAT_BCP_LOCS=$1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="271"></td><td class="FileContents-lineContents" id="271"><span class="com">        # Remove '-Xbootclasspath-locations:' from the argument.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="272"></td><td class="FileContents-lineContents" id="272"><span class="com">        DEX2OAT_BCP_LOCS=${DEX2OAT_BCP_LOCS##-Xbootclasspath-locations:}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="273"></td><td class="FileContents-lineContents" id="273"><span class="com">        ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="274"></td><td class="FileContents-lineContents" id="274"><span class="com">      -cp)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="275"></td><td class="FileContents-lineContents" id="275"><span class="com">        # Reset any previously parsed classpath, just like dalvikvm</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="276"></td><td class="FileContents-lineContents" id="276"><span class="com">        # only supports one -cp argument.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="277"></td><td class="FileContents-lineContents" id="277"><span class="com">        DEX2OAT_CLASSPATH=()</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="278"></td><td class="FileContents-lineContents" id="278"><span class="com">        # TODO: support -classpath and CLASSPATH</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="279"></td><td class="FileContents-lineContents" id="279"><span class="com">        local oifs=$IFS</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="280"></td><td class="FileContents-lineContents" id="280"><span class="com">        IFS=':'</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="281"></td><td class="FileContents-lineContents" id="281"><span class="com">        for classpath_elem in $2</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="282"></td><td class="FileContents-lineContents" id="282"><span class="com">        do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="283"></td><td class="FileContents-lineContents" id="283"><span class="com">          DEX2OAT_CLASSPATH+=("$classpath_elem")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="284"></td><td class="FileContents-lineContents" id="284"><span class="com">        done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="285"></td><td class="FileContents-lineContents" id="285"><span class="com">        shift</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="286"></td><td class="FileContents-lineContents" id="286"><span class="com">        IFS=$oifs</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="287"></td><td class="FileContents-lineContents" id="287"><span class="com">        ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="288"></td><td class="FileContents-lineContents" id="288"><span class="com">    esac</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="289"></td><td class="FileContents-lineContents" id="289"><span class="com">    shift</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="290"></td><td class="FileContents-lineContents" id="290"><span class="com">  done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="291"></td><td class="FileContents-lineContents" id="291"><span class="com">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="292"></td><td class="FileContents-lineContents" id="292"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="293"></td><td class="FileContents-lineContents" id="293"><span class="com"># Runs dalvikvm, returns its exit code.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="294"></td><td class="FileContents-lineContents" id="294"><span class="com"># (Oat directories are cleaned up in between runs)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="295"></td><td class="FileContents-lineContents" id="295"><span class="com">function run_art() {</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="296"></td><td class="FileContents-lineContents" id="296"><span class="com">  local ret</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="297"></td><td class="FileContents-lineContents" id="297"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="298"></td><td class="FileContents-lineContents" id="298"><span class="com">  # Run dalvikvm.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="299"></td><td class="FileContents-lineContents" id="299"><span class="com">  verbose_run ANDROID_DATA="$ANDROID_DATA"                  \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="300"></td><td class="FileContents-lineContents" id="300"><span class="com">              ANDROID_ROOT="$ANDROID_ROOT"                  \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="301"></td><td class="FileContents-lineContents" id="301"><span class="com">              ANDROID_I18N_ROOT="$ANDROID_I18N_ROOT"        \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="302"></td><td class="FileContents-lineContents" id="302"><span class="com">              ANDROID_ART_ROOT="$ANDROID_ART_ROOT"          \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="303"></td><td class="FileContents-lineContents" id="303"><span class="com">              ANDROID_TZDATA_ROOT="$ANDROID_TZDATA_ROOT"    \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="304"></td><td class="FileContents-lineContents" id="304"><span class="com">              LD_LIBRARY_PATH="$LD_LIBRARY_PATH"            \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="305"></td><td class="FileContents-lineContents" id="305"><span class="com">              PATH="$ANDROID_ROOT/bin:$PATH"                \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="306"></td><td class="FileContents-lineContents" id="306"><span class="com">              LD_USE_LOAD_BIAS=1                            \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="307"></td><td class="FileContents-lineContents" id="307"><span class="com">              ANDROID_LOG_TAGS="$ANDROID_LOG_TAGS"          \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="308"></td><td class="FileContents-lineContents" id="308"><span class="com">              $LAUNCH_WRAPPER $ART_BINARY_PATH $lib         \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="309"></td><td class="FileContents-lineContents" id="309"><span class="com">              -XXlib:"$LIBART"                              \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="310"></td><td class="FileContents-lineContents" id="310"><span class="com">              -Xnorelocate                                  \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="311"></td><td class="FileContents-lineContents" id="311"><span class="com">              -Ximage:"$DEFAULT_IMAGE_LOCATION"             \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="312"></td><td class="FileContents-lineContents" id="312"><span class="com">              "$@"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="313"></td><td class="FileContents-lineContents" id="313"><span class="com">  ret=$?</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="314"></td><td class="FileContents-lineContents" id="314"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="315"></td><td class="FileContents-lineContents" id="315"><span class="com">  # Forward exit code of dalvikvm.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="316"></td><td class="FileContents-lineContents" id="316"><span class="com">  return $ret</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="317"></td><td class="FileContents-lineContents" id="317"><span class="com">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="318"></td><td class="FileContents-lineContents" id="318"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="319"></td><td class="FileContents-lineContents" id="319"><span class="com">######################################</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="320"></td><td class="FileContents-lineContents" id="320"><span class="com"># Globals</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="321"></td><td class="FileContents-lineContents" id="321"><span class="com">######################################</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="322"></td><td class="FileContents-lineContents" id="322"><span class="com">ART_BINARY=dalvikvm</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="323"></td><td class="FileContents-lineContents" id="323"><span class="com">DEX2OAT_BINARY=dex2oat</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="324"></td><td class="FileContents-lineContents" id="324"><span class="com">DEX2OAT_SUFFIX=""</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="325"></td><td class="FileContents-lineContents" id="325"><span class="com">DELETE_ANDROID_DATA="no"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="326"></td><td class="FileContents-lineContents" id="326"><span class="com">LAUNCH_WRAPPER=</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="327"></td><td class="FileContents-lineContents" id="327"><span class="com">LIBART=libart.so</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="328"></td><td class="FileContents-lineContents" id="328"><span class="com">JIT_PROFILE="no"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="329"></td><td class="FileContents-lineContents" id="329"><span class="com">ALLOW_DEFAULT_JDWP="no"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="330"></td><td class="FileContents-lineContents" id="330"><span class="com">VERBOSE="no"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="331"></td><td class="FileContents-lineContents" id="331"><span class="com">CLEAN_OAT_FILES="yes"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="332"></td><td class="FileContents-lineContents" id="332"><span class="com">RUN_DEX2OAT="yes"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="333"></td><td class="FileContents-lineContents" id="333"><span class="com"># 'art' script is for benchmarking, so override:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="334"></td><td class="FileContents-lineContents" id="334"><span class="com"># - default JIT thresholds that are too conservative for benchmarking</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="335"></td><td class="FileContents-lineContents" id="335"><span class="com"># - the eagerly releasing memory to the OS on explicit GC, which is more suited</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="336"></td><td class="FileContents-lineContents" id="336"><span class="com">#   for multi-apps execution than benchmarks.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="337"></td><td class="FileContents-lineContents" id="337"><span class="com">EXTRA_OPTIONS=(-Xjitwarmupthreshold:4000 -Xjitthreshold:10000 -XX:+DisableEagerlyReleaseExplicitGC)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="338"></td><td class="FileContents-lineContents" id="338"><span class="com">DEX2OAT_FLAGS=()</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="339"></td><td class="FileContents-lineContents" id="339"><span class="com">DEX2OAT_CLASSPATH=()</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="340"></td><td class="FileContents-lineContents" id="340"><span class="com">GENERATE_APP_IMAGE="no"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="341"></td><td class="FileContents-lineContents" id="341"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="342"></td><td class="FileContents-lineContents" id="342"><span class="com"># Parse arguments</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="343"></td><td class="FileContents-lineContents" id="343"><span class="com">while [[ "$1" = "-"* ]]; do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="344"></td><td class="FileContents-lineContents" id="344"><span class="com">  case "$1" in</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="345"></td><td class="FileContents-lineContents" id="345"><span class="com">  --)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="346"></td><td class="FileContents-lineContents" id="346"><span class="com">    # No more arguments for this script.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="347"></td><td class="FileContents-lineContents" id="347"><span class="com">    shift</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="348"></td><td class="FileContents-lineContents" id="348"><span class="com">    break</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="349"></td><td class="FileContents-lineContents" id="349"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="350"></td><td class="FileContents-lineContents" id="350"><span class="com">  --32)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="351"></td><td class="FileContents-lineContents" id="351"><span class="com">    ART_BINARY=dalvikvm32</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="352"></td><td class="FileContents-lineContents" id="352"><span class="com">    DEX2OAT_SUFFIX=32</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="353"></td><td class="FileContents-lineContents" id="353"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="354"></td><td class="FileContents-lineContents" id="354"><span class="com">  --64)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="355"></td><td class="FileContents-lineContents" id="355"><span class="com">    ART_BINARY=dalvikvm64</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="356"></td><td class="FileContents-lineContents" id="356"><span class="com">    DEX2OAT_SUFFIX=64</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="357"></td><td class="FileContents-lineContents" id="357"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="358"></td><td class="FileContents-lineContents" id="358"><span class="com">  -d)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="359"></td><td class="FileContents-lineContents" id="359"><span class="com">    ;&amp; # Fallthrough</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="360"></td><td class="FileContents-lineContents" id="360"><span class="com">  --debug)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="361"></td><td class="FileContents-lineContents" id="361"><span class="com">    LIBART="libartd.so"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="362"></td><td class="FileContents-lineContents" id="362"><span class="com">    DEX2OAT_BINARY="dex2oatd"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="363"></td><td class="FileContents-lineContents" id="363"><span class="com">    # Expect that debug mode wants all checks.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="364"></td><td class="FileContents-lineContents" id="364"><span class="com">    EXTRA_OPTIONS+=(-XX:SlowDebug=true)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="365"></td><td class="FileContents-lineContents" id="365"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="366"></td><td class="FileContents-lineContents" id="366"><span class="com">  --gdbserver)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="367"></td><td class="FileContents-lineContents" id="367"><span class="com">    LAUNCH_WRAPPER="gdbserver $2"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="368"></td><td class="FileContents-lineContents" id="368"><span class="com">    shift</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="369"></td><td class="FileContents-lineContents" id="369"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="370"></td><td class="FileContents-lineContents" id="370"><span class="com">  --gdb)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="371"></td><td class="FileContents-lineContents" id="371"><span class="com">    LIBART="libartd.so"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="372"></td><td class="FileContents-lineContents" id="372"><span class="com">    LAUNCH_WRAPPER="gdb --args"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="373"></td><td class="FileContents-lineContents" id="373"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="374"></td><td class="FileContents-lineContents" id="374"><span class="com">  --help)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="375"></td><td class="FileContents-lineContents" id="375"><span class="com">    usage</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="376"></td><td class="FileContents-lineContents" id="376"><span class="com">    exit 0</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="377"></td><td class="FileContents-lineContents" id="377"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="378"></td><td class="FileContents-lineContents" id="378"><span class="com">  --invoke-with)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="379"></td><td class="FileContents-lineContents" id="379"><span class="com">    LAUNCH_WRAPPER=$2</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="380"></td><td class="FileContents-lineContents" id="380"><span class="com">    shift</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="381"></td><td class="FileContents-lineContents" id="381"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="382"></td><td class="FileContents-lineContents" id="382"><span class="com">  --perf)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="383"></td><td class="FileContents-lineContents" id="383"><span class="com">    PERF="record"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="384"></td><td class="FileContents-lineContents" id="384"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="385"></td><td class="FileContents-lineContents" id="385"><span class="com">  --perf-report)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="386"></td><td class="FileContents-lineContents" id="386"><span class="com">    PERF="report"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="387"></td><td class="FileContents-lineContents" id="387"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="388"></td><td class="FileContents-lineContents" id="388"><span class="com">  --profile)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="389"></td><td class="FileContents-lineContents" id="389"><span class="com">    JIT_PROFILE="yes"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="390"></td><td class="FileContents-lineContents" id="390"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="391"></td><td class="FileContents-lineContents" id="391"><span class="com">  --verbose)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="392"></td><td class="FileContents-lineContents" id="392"><span class="com">    VERBOSE="yes"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="393"></td><td class="FileContents-lineContents" id="393"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="394"></td><td class="FileContents-lineContents" id="394"><span class="com">  --no-clean)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="395"></td><td class="FileContents-lineContents" id="395"><span class="com">    CLEAN_OAT_FILES="no"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="396"></td><td class="FileContents-lineContents" id="396"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="397"></td><td class="FileContents-lineContents" id="397"><span class="com">  --no-compile)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="398"></td><td class="FileContents-lineContents" id="398"><span class="com">    CLEAN_OAT_FILES="no"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="399"></td><td class="FileContents-lineContents" id="399"><span class="com">    RUN_DEX2OAT="no"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="400"></td><td class="FileContents-lineContents" id="400"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="401"></td><td class="FileContents-lineContents" id="401"><span class="com">  --allow-default-jdwp)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="402"></td><td class="FileContents-lineContents" id="402"><span class="com">    ALLOW_DEFAULT_JDWP="yes"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="403"></td><td class="FileContents-lineContents" id="403"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="404"></td><td class="FileContents-lineContents" id="404"><span class="com">  --*)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="405"></td><td class="FileContents-lineContents" id="405"><span class="com">    echo "unknown option: $1" 1&gt;&amp;2</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="406"></td><td class="FileContents-lineContents" id="406"><span class="com">    usage</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="407"></td><td class="FileContents-lineContents" id="407"><span class="com">    exit 1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="408"></td><td class="FileContents-lineContents" id="408"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="409"></td><td class="FileContents-lineContents" id="409"><span class="com">  *)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="410"></td><td class="FileContents-lineContents" id="410"><span class="com">    break</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="411"></td><td class="FileContents-lineContents" id="411"><span class="com">    ;;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="412"></td><td class="FileContents-lineContents" id="412"><span class="com">  esac</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="413"></td><td class="FileContents-lineContents" id="413"><span class="com">  shift</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="414"></td><td class="FileContents-lineContents" id="414"><span class="com">done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="415"></td><td class="FileContents-lineContents" id="415"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="416"></td><td class="FileContents-lineContents" id="416"><span class="com">if [ $# -eq 0 ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="417"></td><td class="FileContents-lineContents" id="417"><span class="com">  usage</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="418"></td><td class="FileContents-lineContents" id="418"><span class="com">  exit 1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="419"></td><td class="FileContents-lineContents" id="419"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="420"></td><td class="FileContents-lineContents" id="420"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="421"></td><td class="FileContents-lineContents" id="421"><span class="com"># Follow all sym links to get the program name.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="422"></td><td class="FileContents-lineContents" id="422"><span class="com">if [[ -n "$BASH_SOURCE" ]]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="423"></td><td class="FileContents-lineContents" id="423"><span class="com">  PROG_NAME="$BASH_SOURCE"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="424"></td><td class="FileContents-lineContents" id="424"><span class="com">else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="425"></td><td class="FileContents-lineContents" id="425"><span class="com">  PROG_NAME="$0"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="426"></td><td class="FileContents-lineContents" id="426"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="427"></td><td class="FileContents-lineContents" id="427"><span class="com">while [ -h "$PROG_NAME" ]; do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="428"></td><td class="FileContents-lineContents" id="428"><span class="com">  # On Mac OS, readlink -f doesn't work.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="429"></td><td class="FileContents-lineContents" id="429"><span class="com">  PROG_NAME="$(readlink "$PROG_NAME")"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="430"></td><td class="FileContents-lineContents" id="430"><span class="com">done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="431"></td><td class="FileContents-lineContents" id="431"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="432"></td><td class="FileContents-lineContents" id="432"><span class="com">PROG_DIR="$(cd "${PROG_NAME%/*}" ; pwd -P)"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="433"></td><td class="FileContents-lineContents" id="433"><span class="com">ANDROID_ROOT="$(cd $PROG_DIR/..; pwd -P)"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="434"></td><td class="FileContents-lineContents" id="434"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="435"></td><td class="FileContents-lineContents" id="435"><span class="com"># If ANDROID_I18N_ROOT is not set, try to detect whether we are running on</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="436"></td><td class="FileContents-lineContents" id="436"><span class="com"># target or host and set that environment variable to the usual default value.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="437"></td><td class="FileContents-lineContents" id="437"><span class="com">if [ -z "$ANDROID_I18N_ROOT" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="438"></td><td class="FileContents-lineContents" id="438"><span class="com">  # This script is used on host and target (device). However, the (expected)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="439"></td><td class="FileContents-lineContents" id="439"><span class="com">  # default value `ANDROID_I18N_ROOT` is not the same on host and target:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="440"></td><td class="FileContents-lineContents" id="440"><span class="com">  # - on host, `ANDROID_I18N_ROOT` is expected to be</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="441"></td><td class="FileContents-lineContents" id="441"><span class="com">  #   "$ANDROID_ROOT/com.android.i18n";</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="442"></td><td class="FileContents-lineContents" id="442"><span class="com">  # - on target, `ANDROID_I18N_ROOT` is expected to be</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="443"></td><td class="FileContents-lineContents" id="443"><span class="com">  #   "/apex/com.android.i18n".</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="444"></td><td class="FileContents-lineContents" id="444"><span class="com">  #</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="445"></td><td class="FileContents-lineContents" id="445"><span class="com">  # We use the presence/absence of the `$ANDROID_ROOT/../apex` directory to</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="446"></td><td class="FileContents-lineContents" id="446"><span class="com">  # determine whether we are on target or host (this is brittle, but simple).</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="447"></td><td class="FileContents-lineContents" id="447"><span class="com">  if [ -d "$ANDROID_ROOT/../apex" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="448"></td><td class="FileContents-lineContents" id="448"><span class="com">    # Target case.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="449"></td><td class="FileContents-lineContents" id="449"><span class="com">    ANDROID_I18N_ROOT="/apex/com.android.i18n"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="450"></td><td class="FileContents-lineContents" id="450"><span class="com">  else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="451"></td><td class="FileContents-lineContents" id="451"><span class="com">    # Host case.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="452"></td><td class="FileContents-lineContents" id="452"><span class="com">    ANDROID_I18N_ROOT="$ANDROID_ROOT/com.android.i18n"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="453"></td><td class="FileContents-lineContents" id="453"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="454"></td><td class="FileContents-lineContents" id="454"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="455"></td><td class="FileContents-lineContents" id="455"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="456"></td><td class="FileContents-lineContents" id="456"><span class="com"># If ANDROID_ART_ROOT is not set, try to detect whether we are running on</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="457"></td><td class="FileContents-lineContents" id="457"><span class="com"># target or host and set that environment variable to the usual default value.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="458"></td><td class="FileContents-lineContents" id="458"><span class="com">if [ -z "$ANDROID_ART_ROOT" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="459"></td><td class="FileContents-lineContents" id="459"><span class="com">  # This script is used on host and target (device). However, the (expected)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="460"></td><td class="FileContents-lineContents" id="460"><span class="com">  # default value `ANDROID_ART_ROOT` is not the same on host and target:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="461"></td><td class="FileContents-lineContents" id="461"><span class="com">  # - on host, `ANDROID_ART_ROOT` is expected to be</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="462"></td><td class="FileContents-lineContents" id="462"><span class="com">  #   "$ANDROID_ROOT/com.android.art";</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="463"></td><td class="FileContents-lineContents" id="463"><span class="com">  # - on target, `ANDROID_ART_ROOT` is expected to be</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="464"></td><td class="FileContents-lineContents" id="464"><span class="com">  #   "/apex/com.android.art".</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="465"></td><td class="FileContents-lineContents" id="465"><span class="com">  #</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="466"></td><td class="FileContents-lineContents" id="466"><span class="com">  # We use the presence/absence of the `$ANDROID_ROOT/../apex` directory to</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="467"></td><td class="FileContents-lineContents" id="467"><span class="com">  # determine whether we are on target or host (this is brittle, but simple).</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="468"></td><td class="FileContents-lineContents" id="468"><span class="com">  if [ -d "$ANDROID_ROOT/../apex" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="469"></td><td class="FileContents-lineContents" id="469"><span class="com">    # Target case.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="470"></td><td class="FileContents-lineContents" id="470"><span class="com">    ANDROID_ART_ROOT="/apex/com.android.art"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="471"></td><td class="FileContents-lineContents" id="471"><span class="com">  else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="472"></td><td class="FileContents-lineContents" id="472"><span class="com">    # Host case.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="473"></td><td class="FileContents-lineContents" id="473"><span class="com">    ANDROID_ART_ROOT="$ANDROID_ROOT/com.android.art"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="474"></td><td class="FileContents-lineContents" id="474"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="475"></td><td class="FileContents-lineContents" id="475"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="476"></td><td class="FileContents-lineContents" id="476"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="477"></td><td class="FileContents-lineContents" id="477"><span class="com"># If ANDROID_TZDATA_ROOT is not set, try to detect whether we are running on</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="478"></td><td class="FileContents-lineContents" id="478"><span class="com"># target or host and set that environment variable to the usual default value.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="479"></td><td class="FileContents-lineContents" id="479"><span class="com">if [ -z "$ANDROID_TZDATA_ROOT" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="480"></td><td class="FileContents-lineContents" id="480"><span class="com">  # This script is used on host and target (device). However, the (expected)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="481"></td><td class="FileContents-lineContents" id="481"><span class="com">  # default value `ANDROID_TZDATA_ROOT` is not the same on host and target:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="482"></td><td class="FileContents-lineContents" id="482"><span class="com">  # - on host, `ANDROID_TZDATA_ROOT` is expected to be</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="483"></td><td class="FileContents-lineContents" id="483"><span class="com">  #   "$ANDROID_ROOT/com.android.tzdata";</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="484"></td><td class="FileContents-lineContents" id="484"><span class="com">  # - on target, `ANDROID_TZDATA_ROOT` is expected to be</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="485"></td><td class="FileContents-lineContents" id="485"><span class="com">  #   "/apex/com.android.tzdata".</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="486"></td><td class="FileContents-lineContents" id="486"><span class="com">  #</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="487"></td><td class="FileContents-lineContents" id="487"><span class="com">  # We use the presence/absence of the `$ANDROID_ROOT/../apex` directory to</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="488"></td><td class="FileContents-lineContents" id="488"><span class="com">  # determine whether we are on target or host (this is brittle, but simple).</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="489"></td><td class="FileContents-lineContents" id="489"><span class="com">  if [ -d "$ANDROID_ROOT/../apex" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="490"></td><td class="FileContents-lineContents" id="490"><span class="com">    # Target case.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="491"></td><td class="FileContents-lineContents" id="491"><span class="com">    ANDROID_TZDATA_ROOT="/apex/com.android.tzdata"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="492"></td><td class="FileContents-lineContents" id="492"><span class="com">  else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="493"></td><td class="FileContents-lineContents" id="493"><span class="com">    # Host case.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="494"></td><td class="FileContents-lineContents" id="494"><span class="com">    ANDROID_TZDATA_ROOT="$ANDROID_ROOT/com.android.tzdata"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="495"></td><td class="FileContents-lineContents" id="495"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="496"></td><td class="FileContents-lineContents" id="496"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="497"></td><td class="FileContents-lineContents" id="497"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="498"></td><td class="FileContents-lineContents" id="498"><span class="com">ART_BINARY_TARGET_PATH=$ANDROID_ART_ROOT/bin/$ART_BINARY</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="499"></td><td class="FileContents-lineContents" id="499"><span class="com">ART_BINARY_HOST_PATH=$ANDROID_ROOT/bin/$ART_BINARY</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="500"></td><td class="FileContents-lineContents" id="500"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="501"></td><td class="FileContents-lineContents" id="501"><span class="com">if [ -x "$ART_BINARY_TARGET_PATH" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="502"></td><td class="FileContents-lineContents" id="502"><span class="com">  ART_BINARY_PATH="$ART_BINARY_TARGET_PATH"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="503"></td><td class="FileContents-lineContents" id="503"><span class="com">elif [ -x "$ART_BINARY_HOST_PATH" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="504"></td><td class="FileContents-lineContents" id="504"><span class="com">  ART_BINARY_PATH="$ART_BINARY_HOST_PATH"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="505"></td><td class="FileContents-lineContents" id="505"><span class="com">else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="506"></td><td class="FileContents-lineContents" id="506"><span class="com">  cat 1&gt;&amp;2 &lt;&lt;EOF</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="507"></td><td class="FileContents-lineContents" id="507"><span class="com">Android Runtime not found as either $ART_BINARY_TARGET_PATH or $ART_BINARY_HOST_PATH</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="508"></td><td class="FileContents-lineContents" id="508"><span class="com">This script should be in the same directory as the Android Runtime ($ART_BINARY).</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="509"></td><td class="FileContents-lineContents" id="509"><span class="com">EOF</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="510"></td><td class="FileContents-lineContents" id="510"><span class="com">  exit 1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="511"></td><td class="FileContents-lineContents" id="511"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="512"></td><td class="FileContents-lineContents" id="512"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="513"></td><td class="FileContents-lineContents" id="513"><span class="com">DEX2OAT_BINARY_TARGET_PATH=$ANDROID_ART_ROOT/bin/$DEX2OAT_BINARY$DEX2OAT_SUFFIX</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="514"></td><td class="FileContents-lineContents" id="514"><span class="com">DEX2OAT_BINARY_HOST_PATH=$ANDROID_ROOT/bin/$DEX2OAT_BINARY$DEX2OAT_SUFFIX</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="515"></td><td class="FileContents-lineContents" id="515"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="516"></td><td class="FileContents-lineContents" id="516"><span class="com">if [ -x "$DEX2OAT_BINARY_TARGET_PATH" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="517"></td><td class="FileContents-lineContents" id="517"><span class="com">  DEX2OAT_BINARY_PATH="$DEX2OAT_BINARY_TARGET_PATH"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="518"></td><td class="FileContents-lineContents" id="518"><span class="com">elif [ -x "$DEX2OAT_BINARY_HOST_PATH" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="519"></td><td class="FileContents-lineContents" id="519"><span class="com">  DEX2OAT_BINARY_PATH="$DEX2OAT_BINARY_HOST_PATH"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="520"></td><td class="FileContents-lineContents" id="520"><span class="com">else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="521"></td><td class="FileContents-lineContents" id="521"><span class="com">  echo "Warning: Android Compiler not found as either $DEX2OAT_BINARY_TARGET_PATH or $DEX2OAT_BINARY_HOST_PATH"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="522"></td><td class="FileContents-lineContents" id="522"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="523"></td><td class="FileContents-lineContents" id="523"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="524"></td><td class="FileContents-lineContents" id="524"><span class="com"># Ensure the ART binary is present on PATH, in case we're in a chroot on a</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="525"></td><td class="FileContents-lineContents" id="525"><span class="com"># sufficiently old device OS (b/210859761).</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="526"></td><td class="FileContents-lineContents" id="526"><span class="com">if [[ ":$PATH:" != *:$ANDROID_ART_ROOT/bin:* ]]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="527"></td><td class="FileContents-lineContents" id="527"><span class="com">  export PATH="$PATH:$ANDROID_ART_ROOT/bin"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="528"></td><td class="FileContents-lineContents" id="528"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="529"></td><td class="FileContents-lineContents" id="529"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="530"></td><td class="FileContents-lineContents" id="530"><span class="com">######################################</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="531"></td><td class="FileContents-lineContents" id="531"><span class="com"># Main program</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="532"></td><td class="FileContents-lineContents" id="532"><span class="com">######################################</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="533"></td><td class="FileContents-lineContents" id="533"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="534"></td><td class="FileContents-lineContents" id="534"><span class="com"># If android logging is not explicitly set, only print warnings and errors.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="535"></td><td class="FileContents-lineContents" id="535"><span class="com">if [ -z "$ANDROID_LOG_TAGS" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="536"></td><td class="FileContents-lineContents" id="536"><span class="com">  ANDROID_LOG_TAGS='*:w'</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="537"></td><td class="FileContents-lineContents" id="537"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="538"></td><td class="FileContents-lineContents" id="538"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="539"></td><td class="FileContents-lineContents" id="539"><span class="com">LIBDIR="$(find_libdir $ART_BINARY_PATH)"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="540"></td><td class="FileContents-lineContents" id="540"><span class="com">LD_LIBRARY_PATH=$ANDROID_ROOT/$LIBDIR</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="541"></td><td class="FileContents-lineContents" id="541"><span class="com">DEFAULT_IMAGE_LOCATION="$(detect_boot_image_location)"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="542"></td><td class="FileContents-lineContents" id="542"><span class="com">DEX2OAT_BOOT_IMAGE="$DEFAULT_IMAGE_LOCATION"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="543"></td><td class="FileContents-lineContents" id="543"><span class="com">ISA=$(LD_LIBRARY_PATH=$LD_LIBRARY_PATH $ART_BINARY_PATH -showversion | (read art version number isa &amp;&amp; echo $isa))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="544"></td><td class="FileContents-lineContents" id="544"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="545"></td><td class="FileContents-lineContents" id="545"><span class="com"># Extract the dex2oat flags from the list of arguments.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="546"></td><td class="FileContents-lineContents" id="546"><span class="com"># -Xcompiler-options arguments are stored in DEX2OAT_FLAGS array</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="547"></td><td class="FileContents-lineContents" id="547"><span class="com"># -cp argument is split by ':' and stored in DEX2OAT_CLASSPATH</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="548"></td><td class="FileContents-lineContents" id="548"><span class="com"># -Ximage argument is stored in DEX2OAT_BOOT_IMAGE</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="549"></td><td class="FileContents-lineContents" id="549"><span class="com">extract_dex2oat_flags "$@"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="550"></td><td class="FileContents-lineContents" id="550"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="551"></td><td class="FileContents-lineContents" id="551"><span class="com"># If ANDROID_DATA is the system ANDROID_DATA or is not set, use our own,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="552"></td><td class="FileContents-lineContents" id="552"><span class="com"># and ensure we delete it at the end.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="553"></td><td class="FileContents-lineContents" id="553"><span class="com">if [ "$ANDROID_DATA" = "/data" ] || [ "$ANDROID_DATA" = "" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="554"></td><td class="FileContents-lineContents" id="554"><span class="com">  if [[ $PWD != / ]]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="555"></td><td class="FileContents-lineContents" id="555"><span class="com">    ANDROID_DATA="$PWD/android-data$$"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="556"></td><td class="FileContents-lineContents" id="556"><span class="com">  else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="557"></td><td class="FileContents-lineContents" id="557"><span class="com">    # Use /data/local/tmp when running this from adb shell, since it starts out in /</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="558"></td><td class="FileContents-lineContents" id="558"><span class="com">    # by default.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="559"></td><td class="FileContents-lineContents" id="559"><span class="com">    ANDROID_DATA="$ANDROID_DATA/local/tmp/android-data$$"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="560"></td><td class="FileContents-lineContents" id="560"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="561"></td><td class="FileContents-lineContents" id="561"><span class="com">  mkdir -p "$ANDROID_DATA"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="562"></td><td class="FileContents-lineContents" id="562"><span class="com">  DELETE_ANDROID_DATA="yes"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="563"></td><td class="FileContents-lineContents" id="563"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="564"></td><td class="FileContents-lineContents" id="564"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="565"></td><td class="FileContents-lineContents" id="565"><span class="com">if [[ "$DEX2OAT_BCP" = "" &amp;&amp; "$DEX2OAT_BCP_LOCS" != "" ]]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="566"></td><td class="FileContents-lineContents" id="566"><span class="com">  echo "Cannot use -Xbootclasspath-locations without -Xbootclasspath"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="567"></td><td class="FileContents-lineContents" id="567"><span class="com">  exit 1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="568"></td><td class="FileContents-lineContents" id="568"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="569"></td><td class="FileContents-lineContents" id="569"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="570"></td><td class="FileContents-lineContents" id="570"><span class="com"># Create boot class path filename or location list.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="571"></td><td class="FileContents-lineContents" id="571"><span class="com"># It takes one optional argument which is the prefix to be inserted before each entry.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="572"></td><td class="FileContents-lineContents" id="572"><span class="com">function get_boot_class_path() {</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="573"></td><td class="FileContents-lineContents" id="573"><span class="com">  # Note: This must start with the CORE_IMG_JARS in Android.common_path.mk</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="574"></td><td class="FileContents-lineContents" id="574"><span class="com">  local modules="core-oj core-libart okhttp bouncycastle apache-xml core-icu4j conscrypt"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="575"></td><td class="FileContents-lineContents" id="575"><span class="com">  local prefix="$1"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="576"></td><td class="FileContents-lineContents" id="576"><span class="com">  local result=""</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="577"></td><td class="FileContents-lineContents" id="577"><span class="com">  local separator=""</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="578"></td><td class="FileContents-lineContents" id="578"><span class="com">  for module in ${modules}; do</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="579"></td><td class="FileContents-lineContents" id="579"><span class="com">    case "$module" in</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="580"></td><td class="FileContents-lineContents" id="580"><span class="com">      (conscrypt)  local apex="com.android.conscrypt";;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="581"></td><td class="FileContents-lineContents" id="581"><span class="com">      (core-icu4j) local apex="com.android.i18n";;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="582"></td><td class="FileContents-lineContents" id="582"><span class="com">      (*)          local apex="com.android.art";;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="583"></td><td class="FileContents-lineContents" id="583"><span class="com">    esac</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="584"></td><td class="FileContents-lineContents" id="584"><span class="com">    result+="${separator}${prefix}/apex/${apex}/javalib/${module}.jar"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="585"></td><td class="FileContents-lineContents" id="585"><span class="com">    separator=":"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="586"></td><td class="FileContents-lineContents" id="586"><span class="com">  done</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="587"></td><td class="FileContents-lineContents" id="587"><span class="com">  echo "$result"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="588"></td><td class="FileContents-lineContents" id="588"><span class="com">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="589"></td><td class="FileContents-lineContents" id="589"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="590"></td><td class="FileContents-lineContents" id="590"><span class="com"># Create default boot class path if none was provided.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="591"></td><td class="FileContents-lineContents" id="591"><span class="com">if [[ "$DEX2OAT_BCP" = "" ]]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="592"></td><td class="FileContents-lineContents" id="592"><span class="com">  ANDROID_ROOT_MINUS_PWD="${ANDROID_ROOT#$PWD/}"  # For example: out/host/linux-x86</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="593"></td><td class="FileContents-lineContents" id="593"><span class="com">  if [[ "$ANDROID_ROOT_MINUS_PWD" == */</span><span class="pln">host</span><span class="com">/* ]]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="594"></td><td class="FileContents-lineContents" id="594"><span class="com">    DEX2OAT_BCP="$(get_boot_class_path $ANDROID_ROOT)"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="595"></td><td class="FileContents-lineContents" id="595"><span class="com">    DEX2OAT_BCP_LOCS="$(get_boot_class_path $ANDROID_ROOT_MINUS_PWD)"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="596"></td><td class="FileContents-lineContents" id="596"><span class="com">  elif [[ "$ANDROID_ROOT_MINUS_PWD" == */</span><span class="pln">target</span><span class="com">/* ]]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="597"></td><td class="FileContents-lineContents" id="597"><span class="com">    DEX2OAT_BCP="$(get_boot_class_path $ANDROID_ROOT)"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="598"></td><td class="FileContents-lineContents" id="598"><span class="com">    DEX2OAT_BCP_LOCS="$(get_boot_class_path)"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="599"></td><td class="FileContents-lineContents" id="599"><span class="com">  else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="600"></td><td class="FileContents-lineContents" id="600"><span class="com">    echo "Can not determine whether are running on host or target"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="601"></td><td class="FileContents-lineContents" id="601"><span class="com">    exit 1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="602"></td><td class="FileContents-lineContents" id="602"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="603"></td><td class="FileContents-lineContents" id="603"><span class="com">  if [ "$VERBOSE" = "yes" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="604"></td><td class="FileContents-lineContents" id="604"><span class="com">    echo ANDROID_ROOT=$ANDROID_ROOT</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="605"></td><td class="FileContents-lineContents" id="605"><span class="com">    echo DEX2OAT_BOOT_IMAGE=$DEX2OAT_BOOT_IMAGE</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="606"></td><td class="FileContents-lineContents" id="606"><span class="com">    echo DEX2OAT_BCP=$DEX2OAT_BCP</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="607"></td><td class="FileContents-lineContents" id="607"><span class="com">    echo DEX2OAT_BCP_LOCS=$DEX2OAT_BCP_LOCS</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="608"></td><td class="FileContents-lineContents" id="608"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="609"></td><td class="FileContents-lineContents" id="609"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="610"></td><td class="FileContents-lineContents" id="610"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="611"></td><td class="FileContents-lineContents" id="611"><span class="com">if [ "$DEX2OAT_BCP" != "" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="612"></td><td class="FileContents-lineContents" id="612"><span class="com">  EXTRA_OPTIONS+=("-Xbootclasspath:$DEX2OAT_BCP")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="613"></td><td class="FileContents-lineContents" id="613"><span class="com">  DEX2OAT_FLAGS+=("--runtime-arg" "-Xbootclasspath:$DEX2OAT_BCP")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="614"></td><td class="FileContents-lineContents" id="614"><span class="com">  if [ "$DEX2OAT_BCP_LOCS" != "" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="615"></td><td class="FileContents-lineContents" id="615"><span class="com">    EXTRA_OPTIONS+=("-Xbootclasspath-locations:$DEX2OAT_BCP_LOCS")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="616"></td><td class="FileContents-lineContents" id="616"><span class="com">    DEX2OAT_FLAGS+=("--runtime-arg" \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="617"></td><td class="FileContents-lineContents" id="617"><span class="com">                    "-Xbootclasspath-locations:$DEX2OAT_BCP_LOCS")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="618"></td><td class="FileContents-lineContents" id="618"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="619"></td><td class="FileContents-lineContents" id="619"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="620"></td><td class="FileContents-lineContents" id="620"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="621"></td><td class="FileContents-lineContents" id="621"><span class="com">if [ "$PERF" != "" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="622"></td><td class="FileContents-lineContents" id="622"><span class="com">  # -k is for supporting jitted code.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="623"></td><td class="FileContents-lineContents" id="623"><span class="com">  LAUNCH_WRAPPER="perf record -k 1 -g --call-graph dwarf -F 10000 -o $ANDROID_DATA/perf.data -e cycles:u $LAUNCH_WRAPPER"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="624"></td><td class="FileContents-lineContents" id="624"><span class="com">  DEX2OAT_FLAGS+=(--generate-debug-info)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="625"></td><td class="FileContents-lineContents" id="625"><span class="com">  EXTRA_OPTIONS+=(-Xcompiler-option --generate-debug-info)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="626"></td><td class="FileContents-lineContents" id="626"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="627"></td><td class="FileContents-lineContents" id="627"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="628"></td><td class="FileContents-lineContents" id="628"><span class="com">if [ "$ALLOW_DEFAULT_JDWP" = "no" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="629"></td><td class="FileContents-lineContents" id="629"><span class="com">  EXTRA_OPTIONS+=(-XjdwpProvider:none)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="630"></td><td class="FileContents-lineContents" id="630"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="631"></td><td class="FileContents-lineContents" id="631"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="632"></td><td class="FileContents-lineContents" id="632"><span class="com"># First cleanup any left-over 'oat' files from the last time dalvikvm was run.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="633"></td><td class="FileContents-lineContents" id="633"><span class="com">cleanup_oat_directory_for_classpath "$@"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="634"></td><td class="FileContents-lineContents" id="634"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="635"></td><td class="FileContents-lineContents" id="635"><span class="com"># Protect additional arguments in quotes to preserve whitespaces (used by</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="636"></td><td class="FileContents-lineContents" id="636"><span class="com"># run-jdwp-test.sh when running on device), '$' (may be used as part of</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="637"></td><td class="FileContents-lineContents" id="637"><span class="com"># classpath) and other special characters when evaluated.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="638"></td><td class="FileContents-lineContents" id="638"><span class="com">EXTRA_OPTIONS+=("$@")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="639"></td><td class="FileContents-lineContents" id="639"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="640"></td><td class="FileContents-lineContents" id="640"><span class="com">if [ "$JIT_PROFILE" = "yes" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="641"></td><td class="FileContents-lineContents" id="641"><span class="com">  # Create the profile. The runtime expects profiles to be created before</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="642"></td><td class="FileContents-lineContents" id="642"><span class="com">  # execution.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="643"></td><td class="FileContents-lineContents" id="643"><span class="com">  PROFILE_PATH="$ANDROID_DATA/primary.prof"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="644"></td><td class="FileContents-lineContents" id="644"><span class="com">  touch "$PROFILE_PATH"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="645"></td><td class="FileContents-lineContents" id="645"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="646"></td><td class="FileContents-lineContents" id="646"><span class="com">  run_art -Xjitsaveprofilinginfo               \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="647"></td><td class="FileContents-lineContents" id="647"><span class="com">          -Xps-min-methods-to-save:1           \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="648"></td><td class="FileContents-lineContents" id="648"><span class="com">          -Xps-min-classes-to-save:1           \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="649"></td><td class="FileContents-lineContents" id="649"><span class="com">          -Xps-min-notification-before-wake:10 \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="650"></td><td class="FileContents-lineContents" id="650"><span class="com">          -Xps-profile-path:$PROFILE_PATH      \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="651"></td><td class="FileContents-lineContents" id="651"><span class="com">          -Xusejit:true                        \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="652"></td><td class="FileContents-lineContents" id="652"><span class="com">          ${EXTRA_OPTIONS[@]}                  \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="653"></td><td class="FileContents-lineContents" id="653"><span class="com">          &amp;&gt; "$ANDROID_DATA/profile_gen.log"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="654"></td><td class="FileContents-lineContents" id="654"><span class="com">  EXIT_STATUS=$?</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="655"></td><td class="FileContents-lineContents" id="655"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="656"></td><td class="FileContents-lineContents" id="656"><span class="com">  # Remove generated oat files.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="657"></td><td class="FileContents-lineContents" id="657"><span class="com">  cleanup_oat_directory_for_classpath "$@"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="658"></td><td class="FileContents-lineContents" id="658"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="659"></td><td class="FileContents-lineContents" id="659"><span class="com">  if [ $EXIT_STATUS != 0 ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="660"></td><td class="FileContents-lineContents" id="660"><span class="com">    echo "Profile run failed: " &gt;&amp;2</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="661"></td><td class="FileContents-lineContents" id="661"><span class="com">    cat "$ANDROID_DATA/profile_gen.log" &gt;&amp;2</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="662"></td><td class="FileContents-lineContents" id="662"><span class="com">    clean_android_data</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="663"></td><td class="FileContents-lineContents" id="663"><span class="com">    exit $EXIT_STATUS</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="664"></td><td class="FileContents-lineContents" id="664"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="665"></td><td class="FileContents-lineContents" id="665"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="666"></td><td class="FileContents-lineContents" id="666"><span class="com">  # Wipe dalvik-cache so that a subsequent run_art must regenerate it.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="667"></td><td class="FileContents-lineContents" id="667"><span class="com">  # Leave $ANDROID_DATA intact since it contains our profile file.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="668"></td><td class="FileContents-lineContents" id="668"><span class="com">  rm -rf "$ANDROID_DATA/dalvik-cache"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="669"></td><td class="FileContents-lineContents" id="669"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="670"></td><td class="FileContents-lineContents" id="670"><span class="com">  # Append arguments so next invocation of run_art uses the profile.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="671"></td><td class="FileContents-lineContents" id="671"><span class="com">  DEX2OAT_FLAGS+=(--profile-file="$PROFILE_PATH")</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="672"></td><td class="FileContents-lineContents" id="672"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="673"></td><td class="FileContents-lineContents" id="673"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="674"></td><td class="FileContents-lineContents" id="674"><span class="com">if [ -x "$DEX2OAT_BINARY_PATH" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="675"></td><td class="FileContents-lineContents" id="675"><span class="com">  if [ "$RUN_DEX2OAT" = "yes" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="676"></td><td class="FileContents-lineContents" id="676"><span class="com">    # Run dex2oat before launching ART to generate the oat files for the classpath.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="677"></td><td class="FileContents-lineContents" id="677"><span class="com">    run_dex2oat</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="678"></td><td class="FileContents-lineContents" id="678"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="679"></td><td class="FileContents-lineContents" id="679"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="680"></td><td class="FileContents-lineContents" id="680"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="681"></td><td class="FileContents-lineContents" id="681"><span class="com"># Do not continue if the dex2oat failed.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="682"></td><td class="FileContents-lineContents" id="682"><span class="com">EXIT_STATUS=$?</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="683"></td><td class="FileContents-lineContents" id="683"><span class="com">if [ $EXIT_STATUS != 0 ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="684"></td><td class="FileContents-lineContents" id="684"><span class="com">  echo "Failed dex2oat invocation" &gt;&amp;2</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="685"></td><td class="FileContents-lineContents" id="685"><span class="com">  exit $EXIT_STATUS</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="686"></td><td class="FileContents-lineContents" id="686"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="687"></td><td class="FileContents-lineContents" id="687"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="688"></td><td class="FileContents-lineContents" id="688"><span class="com">run_art "${EXTRA_OPTIONS[@]}"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="689"></td><td class="FileContents-lineContents" id="689"><span class="com">EXIT_STATUS=$?</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="690"></td><td class="FileContents-lineContents" id="690"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="691"></td><td class="FileContents-lineContents" id="691"><span class="com">if [ "$PERF" != "" ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="692"></td><td class="FileContents-lineContents" id="692"><span class="com">  if [ "$PERF" = report ]; then</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="693"></td><td class="FileContents-lineContents" id="693"><span class="com">    perf report -i $ANDROID_DATA/perf.data</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="694"></td><td class="FileContents-lineContents" id="694"><span class="com">  else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="695"></td><td class="FileContents-lineContents" id="695"><span class="com">    # Inject jitted code in perf.data. Keep the old perf.data for debugging.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="696"></td><td class="FileContents-lineContents" id="696"><span class="com">    mv $ANDROID_DATA/perf.data $ANDROID_DATA/perf.data.old</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="697"></td><td class="FileContents-lineContents" id="697"><span class="com">    perf inject -j -i $ANDROID_DATA/perf.data.old -o $ANDROID_DATA/perf.data</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="698"></td><td class="FileContents-lineContents" id="698"><span class="com">    echo "Perf data saved in: $ANDROID_DATA/perf.data. Generated oat files not removed."</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="699"></td><td class="FileContents-lineContents" id="699"><span class="com">  fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="700"></td><td class="FileContents-lineContents" id="700"><span class="com">else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="701"></td><td class="FileContents-lineContents" id="701"><span class="com">  # Perf needs the odex files we generate for proper symbolization, so only remove them</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="702"></td><td class="FileContents-lineContents" id="702"><span class="com">  # when not running with perf.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="703"></td><td class="FileContents-lineContents" id="703"><span class="com">  cleanup_oat_directory_for_classpath "$@"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="704"></td><td class="FileContents-lineContents" id="704"><span class="com">  # Perf output is placed under $ANDROID_DATA so not cleaned when perf options used.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="705"></td><td class="FileContents-lineContents" id="705"><span class="com">  clean_android_data</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="706"></td><td class="FileContents-lineContents" id="706"><span class="com">fi</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="707"></td><td class="FileContents-lineContents" id="707"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="708"></td><td class="FileContents-lineContents" id="708"><span class="com">exit $EXIT_STATUS</span></td></tr></tbody></table><script nonce="">for (let lineNumEl of document.querySelectorAll('td.u-lineNum')) {lineNumEl.onclick = () => {window.location.hash = `#${lineNumEl.getAttribute('data-line-number')}`;};}</script></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a>| <a href="https://policies.google.com/terms">Terms</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="https://android.googlesource.com/platform/art/+/master/tools/art?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="https://android.googlesource.com/platform/art/+/master/tools/art?format=JSON">json</a></span></div></footer></body></html>